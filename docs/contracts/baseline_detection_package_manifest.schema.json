{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "pa:baseline_detection_package_manifest:schema:v1",
  "title": "Baseline Detection Package Manifest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "contract_version",
    "schema_version",
    "baseline_id",
    "baseline_version",
    "created_at",
    "profile",
    "source_run",
    "artifact_refs",
    "integrity"
  ],
  "properties": {
    "contract_version": {
      "const": "0.2.0"
    },
    "schema_version": {
      "const": "pa:baseline_detection_package_manifest:v1"
    },
    "baseline_id": {
      "$ref": "#/$defs/id_slug_v1"
    },
    "baseline_version": {
      "$ref": "#/$defs/semver_v1"
    },
    "baseline_package_uuid": {
      "$ref": "#/$defs/uuid_v4"
    },
    "created_at": {
      "$ref": "#/$defs/rfc3339_utc"
    },
    "profile": {
      "const": "detection_eval_v1"
    },
    "description": {
      "type": "string",
      "maxLength": 4096
    },
    "tags": {
      "type": "array",
      "items": { "$ref": "#/$defs/id_slug_v1" },
      "uniqueItems": true,
      "maxItems": 128,
      "default": []
    },
    "blessing": {
      "type": "object",
      "additionalProperties": false,
      "required": ["status"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["unblessed", "blessed", "deprecated"]
        },
        "blessed_at": {
          "$ref": "#/$defs/rfc3339_utc"
        },
        "blessed_by": {
          "type": "string",
          "maxLength": 256
        },
        "notes": {
          "type": "string",
          "maxLength": 4096
        }
      }
    },
    "source_run": {
      "type": "object",
      "additionalProperties": false,
      "required": ["run_id", "run_manifest_sha256"],
      "properties": {
        "run_id": { "$ref": "#/$defs/uuid" },
        "run_manifest_sha256": { "$ref": "#/$defs/digest_sha256" }
      }
    },
    "artifact_refs": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ground_truth_path",
        "ocsf_events_representation",
        "ocsf_events_path"
      ],
      "properties": {
        "ground_truth_path": { "const": "run/ground_truth.jsonl" },
        "ocsf_events_representation": {
          "type": "string",
          "enum": ["parquet_dataset", "jsonl"]
        },
        "ocsf_events_path": {
          "type": "string",
          "minLength": 1,
          "maxLength": 256
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "ocsf_events_representation": { "const": "parquet_dataset" }
            },
            "required": ["ocsf_events_representation"]
          },
          "then": {
            "properties": {
              "ocsf_events_path": { "const": "run/normalized/ocsf_events/" }
            }
          }
        },
        {
          "if": {
            "properties": {
              "ocsf_events_representation": { "const": "jsonl" }
            },
            "required": ["ocsf_events_representation"]
          },
          "then": {
            "properties": {
              "ocsf_events_path": { "const": "run/normalized/ocsf_events.jsonl" }
            }
          }
        }
      ]
    },
    "summary": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "technique_ids": {
          "type": "array",
          "items": { "type": "string", "maxLength": 32 },
          "uniqueItems": true,
          "maxItems": 1024
        },
        "ocsf_event_count": {
          "type": "integer",
          "minimum": 0
        },
        "ground_truth_row_count": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "integrity": {
      "type": "object",
      "additionalProperties": false,
      "required": ["checksums_path", "package_tree_sha256"],
      "properties": {
        "checksums_path": { "const": "security/checksums.txt" },
        "package_tree_sha256": { "$ref": "#/$defs/digest_sha256" },
        "signature_path": { "const": "security/signature.ed25519" },
        "public_key_path": { "const": "security/public_key.ed25519" }
      }
    }
  },
  "$defs": {
    "digest_sha256": {
      "type": "string",
      "pattern": "^sha256:[0-9a-f]{64}$"
    },
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },
    "uuid_v4": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
    },
    "rfc3339_utc": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$"
    },
    "id_slug_v1": {
      "type": "string",
      "pattern": "^(?!.*--)[a-z0-9](?:[a-z0-9-]{0,62}[a-z0-9])?$"
    },
    "semver_v1": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
    }
  }
}
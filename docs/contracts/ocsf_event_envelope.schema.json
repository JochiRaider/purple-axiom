{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://purple-axiom.local/schemas/ocsf_event_envelope.schema.json",
  "title": "Purple Axiom OCSF Event Envelope (OCSF-minimal core)",
  "description": "Validates the minimal OCSF Base Event core for OCSF v1.7.0, as emitted by Purple Axiom. Per spec 055_ocsf_field_tiers.md: Tier 0 fields (time, class_uid, metadata provenance) are MUST; Tier 1 fields (activity_id, category_uid, type_uid, severity_id) are SHOULD.",
  "type": "object",
  "additionalProperties": true,
  "required": [
    "contract_version",
    "time",
    "class_uid",
    "metadata"
  ],
  "properties": {
    "time": {
      "type": "integer",
      "minimum": 0,
      "description": "Event time as milliseconds since Unix epoch (UTC). (OCSF timestamp_t) [Tier 0 - MUST]"
    },
    "time_dt": {
      "type": "string",
      "format": "date-time"
    },
    "class_uid": {
      "type": "integer",
      "minimum": 0,
      "description": "OCSF class_uid. [Tier 0 - MUST]"
    },
    "category_uid": {
      "type": "integer",
      "minimum": 0,
      "description": "OCSF category_uid. [Tier 1 - SHOULD]"
    },
    "type_uid": {
      "type": "integer",
      "minimum": 0,
      "description": "OCSF type_uid. [Tier 1 - SHOULD]"
    },
    "severity_id": {
      "type": "integer",
      "minimum": 0,
      "description": "OCSF severity_id. [Tier 1 - SHOULD]"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "required": [
        "uid",
        "version"
      ],
      "properties": {
        "version": {
          "type": "string",
          "const": "1.7.0",
          "description": "The version of the OCSF schema (SemVer). Pinned by Purple Axiom."
        },
        "product": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "name": {
              "type": "string",
              "minLength": 1,
              "description": "OCSF Product.name"
            },
            "uid": {
              "type": "string",
              "minLength": 1,
              "description": "OCSF Product.uid"
            },
            "vendor_name": {
              "type": "string",
              "minLength": 1,
              "description": "OCSF Product.vendor_name"
            },
            "version": {
              "type": "string",
              "minLength": 1,
              "description": "OCSF Product.version"
            },
            "feature": {
              "type": "object",
              "additionalProperties": true,
              "description": "OCSF Product.feature (optional)"
            }
          },
          "anyOf": [
            {
              "required": [
                "name"
              ]
            },
            {
              "required": [
                "uid"
              ]
            }
          ],
          "description": "The product that reported the event (OCSF Metadata.product). At least one of name or uid MUST be present."
        },
        "extensions": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true,
            "required": [
              "version"
            ],
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1,
                "description": "OCSF Schema Extension.name"
              },
              "uid": {
                "type": "string",
                "minLength": 1,
                "description": "OCSF Schema Extension.uid"
              },
              "version": {
                "type": "string",
                "minLength": 1,
                "description": "OCSF Schema Extension.version"
              }
            },
            "anyOf": [
              {
                "required": [
                  "name"
                ]
              },
              {
                "required": [
                  "uid"
                ]
              }
            ],
            "description": "OCSF Schema Extension object. At least one of name or uid MUST be present."
          },
          "description": "Schema extensions used to create the event (OCSF Metadata.extensions)."
        },
        "uid": {
          "type": "string",
          "minLength": 1,
          "pattern": "^pa:eid:v1:[A-Fa-f0-9]{32}$",
          "description": "OCSF Metadata.uid. In Purple Axiom, this MUST be the deterministic event identifier: \"pa:eid:v1:\" + <128-bit-hex>. This identifier is stable across replays of identical normalized events. [Tier 0 - MUST]"
        },
        "original_event_uid": {
          "type": "string",
          "minLength": 1,
          "description": "The unique identifier assigned to the event in its original logging system (OCSF Metadata.original_event_uid). For Windows Event Log this SHOULD be EventRecordID as a decimal string."
        },
        "event_code": {
          "type": "string",
          "minLength": 1,
          "description": "Identifier of the original event (OCSF Metadata.event_code)."
        },
        "log_name": {
          "type": "string",
          "minLength": 1,
          "description": "The event log name for the consumer (OCSF Metadata.log_name)."
        },
        "log_source": {
          "type": "string",
          "minLength": 1,
          "description": "The log system/component where the data originated (OCSF Metadata.log_source)."
        },
        "log_provider": {
          "type": "string",
          "minLength": 1,
          "description": "The logging provider or logging service (OCSF Metadata.log_provider)."
        },
        "log_format": {
          "type": "string",
          "minLength": 1,
          "description": "The format of data in the log where it originated (OCSF Metadata.log_format)."
        },
        "log_version": {
          "type": "string",
          "minLength": 1,
          "description": "The event log schema version of the original event (OCSF Metadata.log_version)."
        },
        "source": {
          "type": "string",
          "minLength": 1,
          "description": "A distinguishing name for the logical origin of the data (OCSF Metadata.source)."
        },
        "type": {
          "type": "string",
          "minLength": 1,
          "description": "The type of the event or finding as a subset of the source (OCSF Metadata.type)."
        },
        "labels": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Labels attached to the event (OCSF Metadata.labels)."
        },
        "debug": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Debug information about non-fatal issues (OCSF Metadata.debug)."
        },
        "is_truncated": {
          "type": "boolean",
          "description": "Whether the OCSF event data has been truncated (OCSF Metadata.is_truncated)."
        }
      }
    },
    "device": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "hostname": {
          "type": "string"
        },
        "uid": {
          "type": "string"
        },
        "ip": {
          "type": "string"
        },
        "ips": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        }
      }
    },
    "actor": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "user": {
          "type": "object",
          "additionalProperties": true
        },
        "process": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "raw": {
      "type": "object",
      "additionalProperties": true,
      "description": "Optional preserved raw/vendor fields for traceability."
    },
    "contract_version": {
      "type": "string",
      "const": "0.1.0",
      "description": "Contract version stamp for this event envelope."
    },
    "activity_id": {
      "type": "integer",
      "minimum": 0,
      "description": "The normalized identifier of the activity that triggered the event (OCSF Base Event). [Tier 1 - SHOULD]"
    },
    "status_id": {
      "type": "integer",
      "minimum": 0,
      "description": "The normalized identifier of the event status (OCSF Base Event). Recommended by OCSF."      
    }
  }
}
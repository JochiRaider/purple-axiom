# mappings/normalizer/ocsf/1.7.0/osquery/classes/network_activity_4001.yaml
format_version: 1

class_map:
  class_uid: 4001
  class_name: Network Activity
  category_uid: 4

  # For osquery, action is the per-row activity key (event_id_map is the schema alias).
  event_id_map:
    "added": {activity_id: 0}
    "removed": {activity_id: 0}
    "snapshot": {activity_id: 99}

emit:
  class_uid:
    const_from_class: true

  activity_id:
    from_event_id_map: activity_id

  type_uid:
    op: compute_type_uid
    args:
      class_uid_from_class: true
      activity_id_from_event_id_map: true

  # Endpoints: local == src, remote == dst.
  src_endpoint.ip:
    from: columns.local_address
    transforms: [trim_ascii, absent_if_placeholder, normalize_ip]

  src_endpoint.port:
    from: columns.local_port
    transforms: [trim_ascii, parse_port_int]

  dst_endpoint.ip:
    from: columns.remote_address
    transforms: [trim_ascii, absent_if_placeholder, normalize_ip]

  dst_endpoint.port:
    from: columns.remote_port
    transforms: [trim_ascii, parse_port_int]

  actor.process.pid:
    from: columns.pid
    transforms: [trim_ascii, parse_int]

  actor.process.file.path:
    from: columns.path
    transforms: [trim_ascii, absent_if_placeholder]

  actor.process.name:
    from: columns.path
    transforms: [trim_ascii, absent_if_placeholder, extract_basename]

  unmapped.osquery.notes:
    when:
      event_id_in: ["snapshot"]
    const: "snapshot row; activity_id=99 (Other)"

# file: docs/project_viz/architecture/90_notes.yaml
requirements:
  - id: deterministic_run_bundles
    description: Run bundles must be deterministic and contract-backed.
    evidence:
      - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
        section_heading: File-based stage coordination (normative)
        excerpt: Stages MUST communicate by reading and writing contract-backed artifacts.
  - id: schema_validation
    description: All stage outputs must validate against schemas before publish.
    evidence:
      - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
        section_heading: Staging then atomic publish
        excerpt: validate all required schema contracts before publish
  - id: ci_gating
    description: CI verdict must be derived from thresholds.json when present and valid.
    evidence:
      - file: 105_ci_operational_readiness.md
        section_heading: CI contract
        excerpt: If `runs/<run_id>/report/thresholds.json` exists and validates against its schema.

constraints:
  - id: no_inferred_integrations
    description: Do not infer technologies or integrations not explicitly stated.
    evidence:
      - file: 010_scope.md
        section_heading: Non-goals
        excerpt: Do not assume specific vendor stacks unless explicitly required.
  - id: one_shot_local_first
    description: System runs as a one-shot, local-first pipeline.
    evidence:
      - file: 020_architecture.md
        section_heading: Overview
        excerpt: Purple Axiom is a one-shot, local-first pipeline.
  - id: single_host_no_internal_rpc
    description: Executed on a single host without internal service-to-service RPC.
    evidence:
      - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
        section_heading: Decision
        excerpt: executed on a single host without internal service-to-service RPC.
  - id: filesystem_contract_boundary
    description: Run bundle directory is the contract boundary between stages.
    evidence:
      - file: 020_architecture.md
        section_heading: Workspace boundary (local-first)
        excerpt: filesystem contract boundary between stages.
  - id: publish_gate_atomic_publish
    description: Artifacts are staged, validated, and published via atomic rename.
    evidence:
      - file: 000_charter.md
        section_heading: Guiding principles
        excerpt: publish them by atomic rename after validation.
      - file: 015_lab_providers.md
        section_heading: Publish and validation gate
        excerpt: The stage MUST publish by atomic rename into the final run bundle location.
  - id: redaction_safe_by_default
    description: Unredacted artifacts are quarantined and excluded from exports by default.
    evidence:
      - file: 090_security_safety.md
        section_heading: Redaction and quarantine
        excerpt: "Quarantine location: `runs/<run_id>/unredacted/` (default)."
      - file: ADR-0009-run-export-policy-and-log-classification.md
        section_heading: Policy
        excerpt: Exports MUST exclude `unredacted/**` by default.

glossary:
  - term: run bundle
    definition: Filesystem directory containing all artifacts for a run under runs/<run_id>/.
    evidence:
      - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
        section_heading: Run bundle (coordination and evidence plane)
        excerpt: Run bundle (`runs/<run_id>/`) is the authoritative coordination substrate.
  - term: stage
    definition: A pipeline unit that reads inputs from the run bundle and writes outputs back.
    evidence:
      - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
        section_heading: File-based stage coordination (normative)
        excerpt: Stages MUST communicate by reading and writing contract-backed artifacts.
  - term: publish gate
    definition: Write to staging, validate, then publish atomically into final locations.
    evidence:
      - file: glossary.yaml
        section_heading: publish_gate
        excerpt: Write to a staging location first, validate, then publish atomically.
  - term: baseline library
    definition: Set of BDPs under exports/baselines managed via the Operator Interface.
    evidence:
      - file: glossary.yaml
        section_heading: baseline_library
        excerpt: managed via the Operator Interface.
notes:
  open_questions:
    - id: orchestrator_implementation_tech
      question: What runtime language/framework is used for the orchestrator monolith?
      impact: Affects deployment diagram and relationship protocols/auth details.
      evidence:
        - file: ADR-0004-deployment-architecture-and-inter-component-communication.md
          section_heading: Orchestrator (execution plane)
          excerpt: SHOULD execute the core pipeline stages in a single process for v0.1.
    - id: criteria_engine_implementation
      question: What engine executes validation criteria (custom DSL vs embedded runtime)?
      impact: Affects validation stage container internals and dependency edges.
      evidence:
        - file: 035_validation_criteria.md
          section_heading: Execution model
          excerpt: Criteria execution engine details are intentionally abstracted.
    - id: operator_interface_authn_authz
      question: What authentication/authorization applies to the operator interface endpoints?
      impact: Affects trust boundaries and auth fields on operator interface relationships.
      evidence:
        - file: 115_operator_interface.md
          section_heading: Security
          excerpt: Authentication and authorization model TBD.
    - id: golden_dataset_builder_tooling
      question: What tool or process generates golden datasets and when in CI?
      impact: Affects workflows for dataset release and regression.
      evidence:
        - file: 085_golden_datasets.md
          section_heading: Generation
          excerpt: Dataset build process is implementation-defined.
    - id: baseline_package_generation_flow
      question: How are baseline packages created and versioned for reporting regression?
      impact: Affects reporting workflow steps and baseline library relationships.
      evidence:
        - file: 086_detection_baseline_library.md
          section_heading: Baseline package generation
          excerpt: Baseline package generation flow is not specified.
    - id: export_bundle_format_and_transport
      question: What is the export bundle format and how is it transported out of CI?
      impact: Affects external integrations and reporting artifact distribution.
      evidence:
        - file: ADR-0009-run-export-policy-and-log-classification.md
          section_heading: Run export policy (normative)
          excerpt: Export bundle transport is out of scope for v0.1.
    - id: threat_intel_pack_consumers
      question: Which stages consume threat_intel_packs and how represented in workflows?
      impact: Affects additional edges and workflow steps for enrichment.
      evidence:
        - file: ADR-0008-Threat-intelligence-integration-model.md
          section_heading: Interaction with run-bundle snapshots
          excerpt: The owning stage MUST materialize them.
  security_findings: []

# mappings/normalizer/ocsf/1.7.0/windows-sysmon/canonicalization.yaml
format_version: 1

constants:
  placeholder_values:
    - ""
    - "-"
    - "NULL"
    - "null"
    - "(null)"
    - "N/A"

transforms:
  # --- string helpers ---
  trim_ascii:
    kind: string
    op: trim_ascii_whitespace

  lowercase_ascii:
    kind: string
    op: lowercase_ascii

  to_string:
    kind: scalar
    op: to_string

  # --- numeric parsing ---
  parse_int:
    kind: scalar
    op: parse_int
    args:
      base: 10

  # --- timestamps ---
  parse_rfc3339_to_epoch_ms:
    kind: time
    op: parse_rfc3339_to_epoch_ms

  # --- presence / placeholders ---
  absent_if_placeholder:
    kind: presence
    op: absent_if_in_set
    args:
      set_ref: constants.placeholder_values

  # --- path helpers ---
  extract_basename:
    kind: string
    op: extract_basename

  extract_parent_folder:
    kind: string
    op: extract_parent_folder

  # --- user helpers ---
  split_domain_user_name:
    kind: string
    op: split_domain_user
    args:
      delimiter: "\\"
      part: name

  split_domain_user_domain:
    kind: string
    op: split_domain_user
    args:
      delimiter: "\\"
      part: domain

  # --- Sysmon hashes ---
  parse_sysmon_hashes:
    kind: string
    op: parse_kv_list
    args:
      pair_delimiter: ","
      kv_delimiter: "="
      key_trim: true
      value_trim: true
      absent_sentinels:
        - ""
        - "-"
        - "NULL"
        - "null"
        - "(null)"
        - "N/A"
      algorithm_id_map:
        MD5: 1
        SHA1: 2
        SHA-1: 2
        SHA256: 3
        SHA-256: 3
        SHA512: 4
        SHA-512: 4
      unknown_algorithm_id: 99
